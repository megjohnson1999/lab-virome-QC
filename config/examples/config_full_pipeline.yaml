# =============================================================================
# Example Config: Full Pipeline (QC + Two-Stage Assembly)
# =============================================================================
# This configuration runs both QC and the two-stage assembly workflow.
# Use this for a complete analysis from raw reads to assembled contigs.
#
# Two-Stage Assembly Workflow:
#   Stage 1: MEGAHIT assemblies (per-sample or per-group)
#   Stage 2: Rename contigs with unique IDs
#   Stage 3: Concatenate all renamed contigs
#   Stage 4: Flye meta-assembly for final polished output
#
# Usage: snakemake --configfile config/examples/config_full_pipeline.yaml
# =============================================================================

output_dir: "results_full"

# Pipeline control
pipeline:
  start_from: "raw_reads"       # Start from raw sequencing data
  run_assembly: true            # Run both QC AND assembly

  # Assembly strategy (IMPORTANT: Choose based on your analysis goals)
  # ----------------------------------------------------------------------------
  # "by_sample" (DEFAULT, RECOMMENDED):
  #   - Stage 1: MEGAHIT assembles each sample separately
  #   - Stage 2-4: Contigs are renamed, concatenated, and meta-assembled with Flye
  #   - Use for most virome studies
  #   - Output: Final meta-assembled contigs + per-sample MEGAHIT assemblies
  #
  # "by_group":
  #   - Stage 1: MEGAHIT assembles user-defined groups of related samples
  #   - Stage 2-4: Contigs are renamed, concatenated, and meta-assembled with Flye
  #   - Use when samples are biologically related (same patient, same treatment)
  #   - Requires: groups_file parameter (TSV with sample_id and group_id columns)
  #   - Keep groups to ~10 samples or fewer for best assembly quality
  #   - Output: Final meta-assembled contigs + per-group MEGAHIT assemblies
  #
  # NOTE: Global "coassembly" has been removed - research shows it performs
  # worst on all assembly metrics. Use "by_sample" or "by_group" instead.
  # ----------------------------------------------------------------------------
  assembly_strategy: "by_sample"

  # Groups file (required only if assembly_strategy="by_group")
  # See config/examples/sample_groups.tsv for format
  # groups_file: "config/examples/sample_groups.tsv"

# Assembly parameters
assembly:
  min_contig_length: 1000       # Keep contigs >= 1kb (MEGAHIT parameter)

# Quality filtering
quality_threshold: 20
min_read_length: 100

# References (adjust paths as needed)
references:
  phix: "workflow/databases/phix174.fasta"
  vector_contaminants: "workflow/databases/vector_contaminants.fa"
  primer_b_forward: "workflow/databases/primerB.fa"
  primer_b_rc: "workflow/databases/primerB_rc.fa"
  host_genome: "resources/host_genome.fasta"
  rrna: "resources/silva_rrna.fasta"

# Samples - auto-detect from directory
sample_auto_detection:
  enabled: true
  input_dir: "data/raw"
  r1_pattern: "*_R1.fastq.gz"
  r2_pattern: "*_R2.fastq.gz"

# QC thresholds
qc_thresholds:
  max_host_percent: 10
  max_rrna_percent: 20
  min_final_reads: 100000
  max_duplication_rate: 80

resources:
  default_threads: 8
  default_mem_mb: 16000
