# =============================================================================
# Lab Virome QC Pipeline Configuration - Recursive Directory Scanning Example
# =============================================================================
# This configuration demonstrates recursive automatic sample detection
# Useful when your samples are organized in subdirectories

# Output directory
output_dir: "results"

# Quality filtering parameters
quality_threshold: 20  # Phred quality score (Q20 = 99% accuracy)
min_read_length: 100   # Minimum read length after trimming (higher for library prep artifacts)

# Reference databases
references:
  # PhiX174 reference genome (Illumina sequencing control)
  phix: "resources/phix174.fasta"

  # Host genome for depletion
  # Replace with your host organism (human, mouse, etc.)
  host_genome: "resources/host_genome.fasta"

  # rRNA database - should include both SSU (16S/18S) and LSU (23S/28S)
  # Note: SSU-only databases (common for 16S amplicon work) will not remove LSU rRNA
  # Recommended: SILVA SSURef + LSURef combined (see README for download instructions)
  # Download from: https://www.arb-silva.de/download/archive/release_138_1/Exports/
  rrna: "resources/silva_rrna.fasta"

# Sample information - not used when auto-detection is enabled
samples: {}

# Recursive auto sample detection (NEW FEATURE!)
# Automatically finds all paired-end samples in a directory tree
sample_auto_detection:
  enabled: true

  # Root directory containing your fastq.gz files
  # Will search this directory AND all subdirectories
  input_dir: "data"

  # Enable recursive scanning (NEW!)
  recursive: true

  # Optional: limit recursion depth
  # max_depth: 3  # Uncomment to limit to 3 levels deep

  # Example directory structure this would scan:
  # data/
  # ├── run1/
  # │   ├── sample1_R1.fastq.gz
  # │   ├── sample1_R2.fastq.gz
  # │   └── sample2_R1.fastq.gz
  # │   └── sample2_R2.fastq.gz
  # ├── run2/
  # │   ├── sample3_R1.fastq.gz
  # │   ├── sample3_R2.fastq.gz
  # └── pilot/
  #     ├── substudy/
  #     │   ├── pilot_sample1_R1.fastq.gz
  #     │   └── pilot_sample1_R2.fastq.gz

  # Glob patterns for paired-end reads
  r1_pattern: "*_R1.fastq.gz"
  r2_pattern: "*_R2.fastq.gz"

  # Conflict resolution strategy for duplicate sample names
  # With recursive scanning, duplicates are more likely!
  # Options:
  #   "error"     - Stop with error if duplicates found (default)
  #   "prefix_dir" - Add directory name prefix (recommended for recursive)
  #   "newest"    - Use sample from most recently modified directory
  conflict_resolution: "prefix_dir"

  # NOTE: 'recursive' can only be used with 'input_dir', not 'input_dirs'

# QC thresholds for flagging problematic samples
qc_thresholds:
  min_enrichment_score: 10      # ViromeQC enrichment score
  max_host_percent: 10          # Maximum % host reads (VLP failure if exceeded)
  max_rrna_percent: 20          # Maximum % rRNA after removal
  min_final_reads: 100000       # Minimum reads after all QC
  max_duplication_rate: 80      # Maximum % duplication

# Computational resources
# Adjust based on your system
resources:
  default_threads: 8
  default_mem_mb: 16000